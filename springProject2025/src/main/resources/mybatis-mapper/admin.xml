<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
	<mapper namespace="com.example.springProject2025.mapper.AdminMapper">
		
		<!-- slide banner.xml(메인슬라이드) list-->
		<select id="selectSlideBannerList" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
			SELECT *
			FROM MAIN_SLIDE_IMAGE
		</select>
		
		<!-- product banner.xml(제품) list-->
		<select id="selectProductBannerList" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
			SELECT B.*, IMG_PATH
			FROM PRODUCT_BANNER_IMG B
			INNER JOIN PRODUCT_IMG P ON B.PRODUCT_NO = P.PRODUCT_NO			
		</select>
		
		<select id="selectRallyBannerList" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
			SELECT R.*, I.IMG_PATH
			FROM RALLY R
			INNER JOIN RALLY_IMG I ON R.RALLY_NO = I.RALLY_NO		
		</select>
	
	<!-- slide banner 수정/저장-->
	<update id="updateBannerModify" parameterType="hashmap">
	    UPDATE MAIN_SLIDE_IMAGE
	    SET 
	        TITLE           = #{title, jdbcType=VARCHAR},
	        IMAGE_DIR       = #{imageDir, jdbcType=VARCHAR},
	        LINK_URL        = #{linkUrl, jdbcType=VARCHAR},
	        DISPLAY_ORDER   = #{displayOrder, jdbcType=NUMERIC},
	        USER_ID         = #{userId, jdbcType=VARCHAR},
	        CDATE           = SYSDATE
	        WHERE 
	        BANNER_ID       = #{bannerId, jdbcType=NUMERIC}
	</update>

	<!-- slide banner 삭제 -->
	<delete id="deleteSlideBanner" parameterType="hashmap">
		DELETE FROM MAIN_SLIDE_IMAGE
		WHERE BANNER_ID = #{bannerId}
	</delete>
	
	<!-- product banner 삭제 -->
	<delete id="deleteProductBanner" parameterType="hashmap">
		DELETE FROM PRODUCT_BANNER_IMG
		WHERE PBANNER_IMG_NO = #{pBannerImgNo}
	</delete>
	
	<!-- rally banner 삭제 -->
	<delete id="deleteRallyBanner" parameterType="hashmap">
		DELETE FROM RALLY
		WHERE RALLY_NO = #{rallyNo}
	</delete>
	
	<!-- slide banner 추가 -->
    <insert id="insertSlideBanner" parameterType="hashmap">
	    INSERT INTO MAIN_SLIDE_IMAGE
	    (BANNER_ID, TITLE, IMAGE_DIR, LINK_URL, DISPLAY_ORDER, USER_ID, CDATE)
	    VALUES (
	        BANNER_SEQ.NEXTVAL,
	        #{title, jdbcType=VARCHAR},
	        #{imageDir, jdbcType=VARCHAR},
	        #{linkUrl, jdbcType=VARCHAR},
	        NVL(#{displayOrder, jdbcType=NUMERIC}, 0),
	        #{userId, jdbcType=VARCHAR},
	        SYSDATE
	    )
	</insert>
	
	<!-- product banner 추가 -->
	<insert id="insertProductBanner" parameterType="hashmap">
	    INSERT INTO PRODUCT_BANNER_IMG (
	        PBANNER_IMG_NO,
	        TITLE,
	        PRODUCT_NO,
	        PRODUCT_IMG_NO,  IMAGE_DIR,       CDATE
	    ) VALUES (
	        PRODUCT_BANNER_SEQ.NEXTVAL,
	        
	        #{title, jdbcType=VARCHAR},
	        
	        #{productNo, jdbcType=NUMERIC}, 
	        
	        #{productImgNo, jdbcType=VARCHAR},
	        
	        NULL,
	        
	        SYSDATE
	    )
	</insert>
	
	<!-- rally banner 추가 -->
	<insert id="insertRallyBanner" parameterType="hashmap">
		INSERT INTO RALLY (
	        RALLY_NO,
	        RALLY_NAME,
	        RALLY_DATE,
	        APPLICATION_PERIOD,
	        PRICE,
	        PHONE,
	        TYPE,
	        HOST
	    )
	    VALUES (
	        RALLY_SEQ.NEXTVAL,
	        #{rallyName},
	        
	        TO_DATE(#{rallyDate}, 'YYYY-MM-DD'), 
	        
	        TO_DATE(#{applicationPeriod}, 'YYYY-MM-DD'), 
	        
	        #{price},
	        #{phone},
	        #{type},
	        #{host}
	    )
	</insert>




		<!-- 상품 문의내역 전체 개수 조회 -->
		<select id="selectInquiryListCount" parameterType="hashmap" resultType="int">
		    SELECT COUNT(*)
		    FROM PRODUCT_INQUIRY I
		    INNER JOIN USERS U ON I.USER_ID = U.USER_ID
		    <where>
		        <if test="keyword != null and keyword != ''">
		            AND (I.TITLE LIKE '%' || #{keyword} || '%' 
		            OR U.NAME LIKE '%' || #{keyword} || '%'
		            OR I.USER_ID LIKE '%' || #{keyword} || '%')
		        </if>
		        <if test="statusOption != null and statusOption != ''">
		            AND I.STATUS = #{statusOption}
		        </if>
		        <if test="startDate != null and startDate != ''">
		            AND I.CDATE >= TO_DATE(#{startDate}, 'YYYY-MM-DD')
		        </if>
		        <if test="endDate != null and endDate != ''">
		            AND I.CDATE &lt;= TO_DATE(#{endDate}, 'YYYY-MM-DD') + 0.99999
		        </if>
		    </where>
		</select>
		
		<!-- 상품 문의내역 리스트 불러오기 (페이징 적용) -->
		<select id="selectInquiryList" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT *
		    FROM (
		        SELECT SUB.*, ROWNUM AS RN
		        FROM (
		            SELECT I.*, U.NAME
		            FROM PRODUCT_INQUIRY I
		            INNER JOIN USERS U ON I.USER_ID = U.USER_ID
		            <where>
		                <if test="keyword != null and keyword != ''">
		                    AND (I.TITLE LIKE '%' || #{keyword} || '%' 
		                    OR U.NAME LIKE '%' || #{keyword} || '%'
		                    OR I.USER_ID LIKE '%' || #{keyword} || '%')
		                </if>
		                <if test="statusOption != null and statusOption != ''">
		                    AND I.STATUS = #{statusOption}
		                </if>
		                <if test="startDate != null and startDate != ''">
		                    AND I.CDATE >= TO_DATE(#{startDate}, 'YYYY-MM-DD')
		                </if>
		                <if test="endDate != null and endDate != ''">
		                    AND I.CDATE &lt;= TO_DATE(#{endDate}, 'YYYY-MM-DD') + 0.99999
		                </if>
		            </where>
		            ORDER BY I.INQUIRY_NO DESC
		        ) SUB
		    ) 
		    WHERE RN > #{startIndex} AND RN &lt;= #{startIndex} + #{pageSize}
		</select>
		
		<!-- 상품 문의내역 상세보기 -->
		<select id="selectInquiry" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
			SELECT I.*, U.NAME
			FROM PRODUCT_INQUIRY I
			INNER JOIN USERS U ON I.USER_ID = U.USER_ID
			WHERE INQUIRY_NO = #{inquiryNo}
		</select>
		
		<!-- 상품 문의내역 관리자 답변 등록/수정 -->
		<update id="updateInquiryAnswer" parameterType="hashmap">
			UPDATE PRODUCT_INQUIRY
			SET 
				ANSWER = #{answer},
				ANSWER_DATE = SYSDATE,
				STATUS = 'Y'
			WHERE 
				INQUIRY_NO = #{inquiryNo}
		</update>
		
		
		<!-- 주문 목록 개수 조회 -->
		<select id="selectOrdersListCount" parameterType="hashmap" resultType="int">
		    SELECT COUNT(*)
		    FROM ORDERS O
		    INNER JOIN USERS U ON O.USER_ID = U.USER_ID
		    <where>
		        <if test="keyword != null and keyword != ''">
		            AND (U.NAME LIKE '%' || #{keyword} || '%'
		            OR O.USER_ID LIKE '%' || #{keyword} || '%'
		            OR O.ORDER_NO LIKE '%' || #{keyword} || '%')
		        </if>
		        <if test="statusOption != null and statusOption != ''">
		            AND O.STATUS = #{statusOption}
		        </if>
		        <if test="startDate != null and startDate != ''">
		            AND O.CDATE >= TO_DATE(#{startDate}, 'YYYY-MM-DD')
		        </if>
		        <if test="endDate != null and endDate != ''">
		            AND O.CDATE &lt;= TO_DATE(#{endDate}, 'YYYY-MM-DD') + 0.99999
		        </if>
		        AND O.STATUS IN ('신규주문', '배송중', '배송완료')
		    </where>
		</select>
		
		<!-- 주문 목록 조회 (페이징 적용) -->
		<select id="selectOrdersList" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT *
		    FROM (
		        SELECT SUB.*, ROWNUM AS RN
		        FROM (
		            SELECT O.ORDER_NO, O.USER_ID, U.NAME, O.PRODUCT_NO, O.QUANTITY,
		                   O.PAYMENT_AMOUNT, O.ADDR, O.PAYMENT_METHOD, O.STATUS,
		                   TO_CHAR(O.CDATE, 'YYYY-MM-DD') AS CDATE,
		                   TO_CHAR(O.UDATE, 'YYYY-MM-DD') AS UDATE,
		                   O.BECAUSE, O.ORDER_REQUEST
		            FROM ORDERS O
		            INNER JOIN USERS U ON O.USER_ID = U.USER_ID
		            <where>
		                <if test="keyword != null and keyword != ''">
		                    AND (U.NAME LIKE '%' || #{keyword} || '%'
		                    OR O.USER_ID LIKE '%' || #{keyword} || '%'
		                    OR O.ORDER_NO LIKE '%' || #{keyword} || '%'
		                    OR O.PRODUCT_NO LIKE '%' || #{keyword} || '%')
		                </if>
		                <if test="statusOption != null and statusOption != ''">
		                    AND O.STATUS = #{statusOption}
		                </if>
		                <if test="startDate != null and startDate != ''">
		                    AND O.CDATE >= TO_DATE(#{startDate}, 'YYYY-MM-DD')
		                </if>
		                <if test="endDate != null and endDate != ''">
		                    AND O.CDATE &lt;= TO_DATE(#{endDate}, 'YYYY-MM-DD') + 0.99999
		                </if>
		                AND O.STATUS IN ('신규주문', '배송중', '배송완료')
		            </where>
		            ORDER BY O.ORDER_NO DESC
		        ) SUB
		    )
		    WHERE RN > #{startIndex} AND RN &lt;= #{startIndex} + #{pageSize}
		</select>
		
		<!-- 주문 상태 업데이트 -->
		<update id="updateOrderStatus" parameterType="hashmap">
		    UPDATE ORDERS
		    SET STATUS = #{newStatus},
		        UDATE = SYSDATE
		    WHERE ORDER_NO = #{orderNo}
		</update>
		
		
		<!-- 회원 목록 개수 조회 -->
		<select id="selectUserListCount" parameterType="hashmap" resultType="int">
		    SELECT COUNT(*)
		    FROM USERS
		    <where>
		        <if test="keyword != null and keyword != ''">
		            <choose>
		                <when test="sortColumn == 'USER_ID'">
		                    AND USER_ID LIKE '%' || #{keyword} || '%'
		                </when>
		                <when test="sortColumn == 'NAME'">
		                    AND NAME LIKE '%' || #{keyword} || '%'
		                </when>
		                <when test="sortColumn == 'NICKNAME'">
		                    AND NICKNAME LIKE '%' || #{keyword} || '%'
		                </when>
		                <otherwise>
		                    AND (USER_ID LIKE '%' || #{keyword} || '%'
		                    OR NAME LIKE '%' || #{keyword} || '%'
		                    OR NICKNAME LIKE '%' || #{keyword} || '%')
		                </otherwise>
		            </choose>
		        </if>
		        <!-- statusOption 등 다른 필터가 있다면 여기에 추가 -->
		    </where>
		</select>
		
		<!-- 회원 목록 조회 (페이징, 검색, 정렬 적용) -->
		<select id="selectUserList" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT *
		    FROM (
		        SELECT SUB.*, ROWNUM AS RN
		        FROM (
		            SELECT USER_ID, NAME, NICKNAME, EMAIL, TO_CHAR(CDATE, 'YYYY-MM-DD') AS CDATE
		            FROM USERS
		            <where>
		                <if test="keyword != null and keyword != ''">
		                    <choose>
		                        <when test="sortColumn == 'USER_ID'">
		                            AND USER_ID LIKE '%' || #{keyword} || '%'
		                        </when>
		                        <when test="sortColumn == 'NAME'">
		                            AND NAME LIKE '%' || #{keyword} || '%'
		                        </when>
		                        <when test="sortColumn == 'NICKNAME'">
		                            AND NICKNAME LIKE '%' || #{keyword} || '%'
		                        </when>
		                        <otherwise>
		                            AND (USER_ID LIKE '%' || #{keyword} || '%'
		                            OR NAME LIKE '%' || #{keyword} || '%'
		                            OR NICKNAME LIKE '%' || #{keyword} || '%')
		                        </otherwise>
		                    </choose>
		                </if>
		            </where>
		            <!-- 정렬 기준 -->
		            <if test="sortColumn != null and sortColumn != ''">
		                ORDER BY
		                <choose>
		                    <when test="sortColumn == 'USER_ID'">USER_ID ASC</when>
		                    <when test="sortColumn == 'NAME'">NAME ASC</when>
		                    <when test="sortColumn == 'NICKNAME'">NICKNAME ASC</when>
		                    <otherwise>CDATE DESC</otherwise> <!-- 기본 정렬 -->
		                </choose>
		            </if>
		            <if test="sortColumn == null or sortColumn == ''">
		                ORDER BY CDATE DESC
		            </if>
		        ) SUB
		    )
		    WHERE RN > #{startIndex} AND RN &lt;= #{startIndex} + #{pageSize}
		</select>
		
		<!-- 회원 상세 정보 조회 -->
		<select id="selectUserDetail" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT USER_ID, PWD, NAME, NICKNAME, GENDER, EMAIL, ADDR, BIRTH, PHONE,
		           TO_CHAR(CDATE, 'YYYY-MM-DD HH24:MI:SS') AS CDATE,
		           TO_CHAR(UDATE, 'YYYY-MM-DD HH24:MI:SS') AS UDATE,
		           USERTYPE
		    FROM USERS
		    WHERE USER_ID = #{userId}
		</select>
		
		<!-- 회원 삭제 -->
		<delete id="deleteUser" parameterType="hashmap">
		    DELETE FROM USERS
		    WHERE USER_ID = #{userId}
		</delete>
		
		<!-- 교환/반품/취소 목록 개수 조회 -->
		<select id="selectRefundReturnListCount" parameterType="hashmap" resultType="int">
		    SELECT COUNT(O.ORDER_NO)
		    FROM ORDERS O
		    JOIN PRODUCT P ON O.PRODUCT_NO = P.PRODUCT_NO
		    JOIN USERS U ON O.USER_ID = U.USER_ID
		    <where>
		        O.STATUS IN ('교환요청', '교환완료', '취소요청', '취소완료', '반품요청', '반품완료')
		        <if test="keyword != null and keyword != ''">
		            AND (P.PRODUCT_NAME LIKE '%' || #{keyword} || '%'
		            OR O.USER_ID LIKE '%' || #{keyword} || '%'
		            OR U.NAME LIKE '%' || #{keyword} || '%'
		            OR O.ORDER_NO LIKE '%' || #{keyword} || '%')
		        </if>
		        <if test="statusOption != null and statusOption != ''">
		            AND O.STATUS = #{statusOption}
		        </if>
		        <if test="startDate != null and startDate != ''">
		            AND O.UDATE >= TO_DATE(#{startDate}, 'YYYY-MM-DD')
		        </if>
		        <if test="endDate != null and endDate != ''">
		            AND O.UDATE &lt;= TO_DATE(#{endDate}, 'YYYY-MM-DD') + 0.99999
		        </if>
		    </where>
		</select>
		
		<!-- 교환/반품/취소 목록 조회 -->
		<select id="selectRefundReturnList" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT *
		    FROM (
		        SELECT SUB.*, ROWNUM AS RN
		        FROM (
		            SELECT
		                O.ORDER_NO,
		                P.PRODUCT_NAME,
		                O.USER_ID,
		                U.NAME,
		                U.PHONE,
		                TO_CHAR(O.UDATE, 'YYYY-MM-DD') AS UDATE,
		                O.STATUS,
		                O.PRODUCT_NO, <!-- 교환 처리 시 필요 -->
		                O.QUANTITY,   <!-- 교환 처리 시 필요 -->
		                O.BECAUSE     <!-- 교환/반품/취소 사유 -->
		            FROM ORDERS O
		            JOIN PRODUCT P ON O.PRODUCT_NO = P.PRODUCT_NO
		            JOIN USERS U ON O.USER_ID = U.USER_ID
		            <where>
		                O.STATUS IN ('교환요청', '교환완료', '취소요청', '취소완료', '반품요청', '반품완료')
		                <if test="keyword != null and keyword != ''">
		                    AND (P.PRODUCT_NAME LIKE '%' || #{keyword} || '%'
		                    OR O.USER_ID LIKE '%' || #{keyword} || '%'
		                    OR U.NAME LIKE '%' || #{keyword} || '%'
		                    OR O.ORDER_NO LIKE '%' || #{keyword} || '%')
		                </if>
		                <if test="statusOption != null and statusOption != ''">
		                    AND O.STATUS = #{statusOption}
		                </if>
		                <if test="startDate != null and startDate != ''">
		                    AND O.UDATE >= TO_DATE(#{startDate}, 'YYYY-MM-DD')
		                </if>
		                <if test="endDate != null and endDate != ''">
		                    AND O.UDATE &lt;= TO_DATE(#{endDate}, 'YYYY-MM-DD') + 0.99999
		                </if>
		            </where>
		            ORDER BY O.UDATE DESC, O.ORDER_NO DESC
		        ) SUB
		    )
		    WHERE RN > #{startIndex} AND RN &lt;= #{startIndex} + #{pageSize}
		</select>
		
		<!-- 교환/반품/취소 상태 업데이트 (일반적인 상태 변경) -->
		<update id="updateRefundReturnStatus" parameterType="hashmap">
		    UPDATE ORDERS
		    SET STATUS = #{status},
		        UDATE = SYSDATE
		    WHERE ORDER_NO = #{orderNo}
		    AND STATUS = #{currentStatus} <!-- 현재 상태와 일치할 때만 업데이트 (안전장치) -->
		</update>
		
		<!-- 특정 주문 번호의 제품 정보(productNo, quantity) 조회 -->
		<select id="selectOrderProductInfo" parameterType="hashmap" resultType="hashmap">
		    SELECT PRODUCT_NO, QUANTITY
		    FROM ORDERS
		    WHERE ORDER_NO = #{orderNo}
		</select>
		
		<!-- 제품 재고 업데이트 (+ 또는 -) -->
		<update id="updateProductStock" parameterType="hashmap">
		    UPDATE PRODUCT
		    SET QUANTITY = QUANTITY + #{quantityChange}
		    WHERE PRODUCT_NO = #{productNo}
		</update>
		
		<!-- 제품 판매량(SELL_COUNT) 업데이트 (+ 또는 -) -->
		<update id="updateProductSellCount" parameterType="hashmap">
		    UPDATE PRODUCT
		    SET SELL_COUNT = SELL_COUNT + #{quantityChange}
		    WHERE PRODUCT_NO = #{productNo}
		</update>
		
		<!-- 주문 상세 정보 전체 조회 (새로운 주문 생성에 재활용하기 위함) -->
		<select id="selectOrderDetailsByOrderNo" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT
		        ORDER_NO, USER_ID, PRODUCT_NO, QUANTITY, PAYMENT_AMOUNT,
		        ADDR, PAYMENT_METHOD, STATUS, BECAUSE, ORDER_REQUEST,
		        CDATE, UDATE <!-- CDATE, UDATE도 가져옴 (CDATE는 새 주문에 복사) -->
		    FROM ORDERS
		    WHERE ORDER_NO = #{orderNo}
		</select>
		
		<!-- 새로운 주문 번호 시퀀스 가져오기 (Oracle 예시) -->
		<select id="getNextOrderNoSequence" resultType="int">
		    SELECT ORDERS_SEQ.NEXTVAL FROM DUAL
		</select>
		
		<!-- 교환으로 인한 신규 주문 삽입 -->
		<insert id="insertNewOrderForExchange" parameterType="com.example.springProject2025.model.Admin">
		    INSERT INTO ORDERS (
		        ORDER_NO, USER_ID, CDATE, PRODUCT_NO, QUANTITY,
		        PAYMENT_AMOUNT, ADDR, PAYMENT_METHOD, STATUS, ORDER_REQUEST, UDATE
		    ) VALUES (
		        #{orderNo},
		        #{userId},
		        SYSDATE, <!-- 새 주문이므로 현재 시간 -->
		        #{productNo},
		        #{quantity},
		        #{paymentAmount},
		        #{addr},
		        #{paymentMethod},
		        #{status},
		        NULL,
		        SYSDATE
		    )
		</insert>
		
		<!-- productNo로 제품 상세 정보 조회 -->
		<select id="selectProductByProductNo" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT PRODUCT_NO, BRAND, PRODUCT_NAME, PRICE, PRODUCT_SIZE, QUANTITY AS PRODUCT_STOCK <!-- QUANTITY를 PRODUCT_STOCK으로 별칭 -->
		    FROM PRODUCT
		    WHERE PRODUCT_NO = #{productNo}
		</select>
		
		<!-- 동일 브랜드, 제품명(괄호 전 부분)의 모든 관련 제품 옵션 조회 (재고가 0 이상인 것만) -->
		<select id="selectRelatedProductOptions" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT
		        PRODUCT_NO,
		        PRODUCT_NAME,
		        QUANTITY,
		        PRICE
		    FROM PRODUCT
		    WHERE
		        BRAND = #{brand} <!-- 동일 브랜드 내에서 검색 (service에서 map에 넣어준 brand) -->
		        AND PRODUCT_NAME LIKE #{baseProductName} || '%'
		        AND QUANTITY > 0 <!-- 재고가 있는 제품만 -->
		    ORDER BY PRODUCT_NAME, PRODUCT_SIZE
		</select>
		
		<!-- 신고 게시물 목록 개수 조회 -->
		<select id="selectBoardReportListCount" parameterType="hashmap" resultType="int">
		    SELECT COUNT(RB.REPORT_BOARD_NO)
		    FROM REPORT_BOARD RB
		    JOIN BOARD B ON RB.BOARD_NO = B.BOARD_NO
		    JOIN USERS U_R ON RB.REPORTER_ID = U_R.USER_ID <!-- 신고자 -->
		    JOIN USERS U_B ON B.USER_ID = U_B.USER_ID <!-- 게시글 작성자 -->
		    <where>
		        <if test="keyword != null and keyword != ''">
		            AND (B.TITLE LIKE '%' || #{keyword} || '%'
		            OR B.CONTENTS LIKE '%' || #{keyword} || '%'
		            OR B.USER_ID LIKE '%' || #{keyword} || '%'
		            OR RB.REPORTER_ID LIKE '%' || #{keyword} || '%')
		        </if>
		        <if test="reportStatus != null and reportStatus != ''">
		            AND RB.STATUS = #{reportStatus}
		        </if>
		        <if test="startDate != null and startDate != ''">
		            AND RB.CDATE >= TO_DATE(#{startDate}, 'YYYY-MM-DD')
		        </if>
		        <if test="endDate != null and endDate != ''">
		            AND RB.CDATE &lt;= TO_DATE(#{endDate}, 'YYYY-MM-DD') + 0.99999
		        </if>
		    </where>
		</select>
		
		<!-- 신고 게시물 목록 조회 -->
		<select id="selectBoardReportList" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT *
		    FROM (
		        SELECT SUB.*, ROWNUM AS RN
		        FROM (
		            SELECT
		                RB.REPORT_BOARD_NO AS REPORTBOARDNO,
		                RB.BOARD_NO AS REPORTEDBOARDNO, <!-- 신고된 게시글 번호 -->
		                RB.REPORTER_ID AS REPORTERID,    <!-- 신고자 아이디 -->
		                TO_CHAR(RB.CDATE, 'YYYY-MM-DD') AS CDATE, <!-- 신고 날짜 -->
		                RB.STATUS AS REPORTSTATUS,      <!-- 신고 확인 상태 -->
		                B.TITLE AS BOARDTITLE,         <!-- 게시글 제목 (추가 조회) -->
		                B.USER_ID AS BOARDUSERID,      <!-- 게시글 작성자 ID (추가 조회) -->
		                U_R.NAME AS REPORTERNAME,       <!-- 신고자 이름 (추가 조회) -->
		                U_B.NAME AS BOARDAUTHORNAME     <!-- 게시글 작성자 이름 (추가 조회) -->
		            FROM REPORT_BOARD RB
		            JOIN BOARD B ON RB.BOARD_NO = B.BOARD_NO
		            JOIN USERS U_R ON RB.REPORTER_ID = U_R.USER_ID <!-- 신고자 정보 가져오기 -->
		            JOIN USERS U_B ON B.USER_ID = U_B.USER_ID <!-- 게시글 작성자 정보 가져오기 -->
		            <where>
		                <if test="keyword != null and keyword != ''">
		                    AND (B.TITLE LIKE '%' || #{keyword} || '%'
		                    OR B.CONTENTS LIKE '%' || #{keyword} || '%'
		                    OR B.USER_ID LIKE '%' || #{keyword} || '%'
		                    OR RB.REPORTER_ID LIKE '%' || #{keyword} || '%')
		                </if>
		                <if test="reportStatus != null and reportStatus != ''">
		                    AND RB.STATUS = #{reportStatus}
		                </if>
		                <if test="startDate != null and startDate != ''">
		                    AND RB.CDATE >= TO_DATE(#{startDate}, 'YYYY-MM-DD')
		                </if>
		                <if test="endDate != null and endDate != ''">
		                    AND RB.CDATE &lt;= TO_DATE(#{endDate}, 'YYYY-MM-DD') + 0.99999
		                </if>
		            </where>
		            ORDER BY RB.CDATE DESC, RB.REPORT_BOARD_NO DESC
		        ) SUB
		    )
		    WHERE RN > #{startIndex} AND RN &lt;= #{startIndex} + #{limit}
		</select>
		
		<!-- 신고 게시물 상세 조회 -->
		<select id="selectBoardReportDetail" parameterType="hashmap" resultType="com.example.springProject2025.model.Admin">
		    SELECT
		        RB.REPORT_BOARD_NO AS REPORTBOARDNO,
		        RB.BOARD_NO AS REPORTEDBOARDNO,
		        RB.REPORTER_ID AS REPORTERID,
		        TO_CHAR(RB.CDATE, 'YYYY-MM-DD') AS CDATE,
		        RB.STATUS AS REPORTSTATUS,
		        B.BOARD_NO AS BOARDNO,          <!-- BOARD_NO를 명시적으로 Board 테이블 컬럼으로 -->
		        B.TYPE AS BOARDTYPE,            <!-- 게시판 유형 -->
		        B.TITLE AS BOARDTITLE,          <!-- 게시글 제목 -->
		        B.CONTENTS AS BOARDCONTENT,     <!-- 게시글 내용 -->
		        B.USER_ID AS BOARDUSERID,       <!-- 게시글 작성자 ID -->
		        U_R.NAME AS REPORTERNAME,       <!-- 신고자 이름 -->
		        U_B.NAME AS BOARDAUTHORNAME     <!-- 게시글 작성자 이름 -->
		    FROM REPORT_BOARD RB
		    JOIN BOARD B ON RB.BOARD_NO = B.BOARD_NO
		    JOIN USERS U_R ON RB.REPORTER_ID = U_R.USER_ID
		    JOIN USERS U_B ON B.USER_ID = U_B.USER_ID
		    WHERE RB.REPORT_BOARD_NO = #{reportBoardNo}
		</select>
		
		<!-- 신고 확인 상태 'Y'로 변경 -->
		<update id="updateReportStatusToY" parameterType="hashmap">
		    UPDATE REPORT_BOARD
		    SET STATUS = 'Y'
		    WHERE REPORT_BOARD_NO = #{reportBoardNo}
		</update>
		
		<!-- 게시글 삭제 -->
		<delete id="deleteBoard" parameterType="hashmap">
		    DELETE FROM BOARD
		    WHERE BOARD_NO = #{reportedBoardNo}
		</delete>
		
		
		<!-- - 대시보드 쿼리들 - -->

	    <!-- 주문 현황 (상태별 건수) -->
	    <select id="selectOrderStatusCounts" resultType="hashmap">
	        SELECT STATUS, COUNT(ORDER_NO) AS COUNT
	        FROM ORDERS
	        GROUP BY STATUS
	        ORDER BY
	            CASE STATUS
	                WHEN '신규주문' THEN 1
	                WHEN '배송중' THEN 2
	                WHEN '배송완료' THEN 3
	                WHEN '교환요청' THEN 4
	                WHEN '교환완료' THEN 5
	                WHEN '취소요청' THEN 6
	                WHEN '취소완료' THEN 7
	                WHEN '반품요청' THEN 8
	                WHEN '반품완료' THEN 9
	                ELSE 10
	            END ASC
	    </select>
	
	    <!-- 총 매출 (배송완료, 교환완료 상태만 합산) -->
	    <select id="selectTotalSales" resultType="long">
	        SELECT NVL(SUM(PAYMENT_AMOUNT), 0)
	        FROM ORDERS
	        WHERE STATUS IN ('배송완료', '교환완료')
	    </select>
	
	    <!-- 이번 달 매출 (배송완료, 교환완료 상태만 합산) -->
	    <select id="selectMonthlySales" resultType="long">
	        SELECT NVL(SUM(PAYMENT_AMOUNT), 0)
	        FROM ORDERS
	        WHERE STATUS IN ('배송완료', '교환완료')
	        AND TO_CHAR(CDATE, 'YYYYMM') = TO_CHAR(SYSDATE, 'YYYYMM')
	    </select>
	
	    <!-- 지난 6개월 간 월별 매출 (라인 그래프용) -->
	    <select id="selectLastSixMonthsSales" resultType="hashmap">
		    WITH MONTH_DATA AS (
		        -- 현재 월부터 6개월 전까지의 월 목록을 생성합니다. (Oracle의 Hierarchical Query 또는 Recursive CTE 사용)
		        SELECT
		            TO_CHAR(ADD_MONTHS(TRUNC(SYSDATE, 'MM'), 1 - LEVEL), 'YYYY-MM') AS SALES_MONTH,
		            ADD_MONTHS(TRUNC(SYSDATE, 'MM'), 1 - LEVEL) AS MONTH_START_DATE
		        FROM DUAL
		        CONNECT BY LEVEL <![CDATA[<=]]> 6
		    )
		    SELECT
		        MD.SALES_MONTH,
		        NVL(SUM(O.PAYMENT_AMOUNT), 0) AS MONTHLY_SALES
		    FROM MONTH_DATA MD
		    LEFT JOIN ORDERS O ON TO_CHAR(O.CDATE, 'YYYY-MM') = MD.SALES_MONTH
		                       AND O.STATUS IN ('배송완료', '교환완료')
		    GROUP BY MD.SALES_MONTH, MD.MONTH_START_DATE
		    ORDER BY MD.MONTH_START_DATE ASC
		</select>
	
	    <!-- 총 상품 수 -->
	    <select id="selectTotalProductCount" resultType="int">
	        SELECT COUNT(PRODUCT_NO) FROM PRODUCT
	    </select>
	
	    <!-- 재고 있음 상품 수 -->
	    <select id="selectInStockProductCount" resultType="int">
	        SELECT COUNT(PRODUCT_NO) FROM PRODUCT WHERE QUANTITY > 0
	    </select>
	
	    <!-- 품절 임박 상품 수 (재고 1~9개) -->
	    <select id="selectLowStockProductCount" resultType="int">
	        SELECT COUNT(PRODUCT_NO) FROM PRODUCT WHERE QUANTITY BETWEEN 1 AND 9
	    </select>
	
	    <!-- 판매량 Top N 상품 (LIMIT 대신 FETCH FIRST ROWS ONLY 사용) -->
	    <select id="selectTopSellingProducts" parameterType="int" resultType="com.example.springProject2025.model.Admin">
	        SELECT PRODUCT_NO, PRODUCT_NAME, SELL_COUNT
	        FROM PRODUCT
	        ORDER BY SELL_COUNT DESC
	        FETCH FIRST #{limit} ROWS ONLY
	    </select>
	
	    <!-- 총 회원 수 (일반 회원만) -->
	    <select id="selectTotalUserCount" resultType="int">
	        SELECT COUNT(USER_ID) FROM USERS WHERE USERTYPE = 'U'
	    </select>
	
	    <!-- 오늘 가입한 신규 회원 수 -->
	    <select id="selectNewUsersTodayCount" resultType="int">
	        SELECT COUNT(USER_ID) FROM USERS WHERE USERTYPE = 'U' AND TRUNC(CDATE) = TRUNC(SYSDATE)
	    </select>
	
	    <!-- 이번 달 가입한 신규 회원 수 -->
	    <select id="selectNewUsersMonthCount" resultType="int">
	        SELECT COUNT(USER_ID) FROM USERS WHERE USERTYPE = 'U' AND TO_CHAR(CDATE, 'YYYYMM') = TO_CHAR(SYSDATE, 'YYYYMM')
	    </select>
	
	    <!-- 배송 중인 주문 수 -->
	    <select id="selectDeliveryInProgressCount" resultType="int">
	        SELECT COUNT(ORDER_NO) FROM ORDERS WHERE STATUS = '배송중'
	    </select>
	
	    <!-- 신규 신고 게시물 수 (처리요망 상태 'N') -->
	    <select id="selectNewReportsCount" resultType="int">
	        SELECT COUNT(REPORT_BOARD_NO) FROM REPORT_BOARD WHERE STATUS = 'N'
	    </select>
	
	    <!-- 반품 요청 대기 수 -->
	    <select id="selectRefundRequestsCount" resultType="int">
	        SELECT COUNT(ORDER_NO) FROM ORDERS WHERE STATUS = '반품요청'
	    </select>
	
	    <!-- 교환 요청 대기 수 -->
	    <select id="selectExchangeRequestsCount" resultType="int">
	        SELECT COUNT(ORDER_NO) FROM ORDERS WHERE STATUS = '교환요청'
	    </select>
	
	    <!-- 신규 상품 문의 (답변 대기중 'N') -->
	    <select id="selectNewProductInquiriesCount" resultType="int">
	        SELECT COUNT(INQUIRY_NO) FROM PRODUCT_INQUIRY WHERE STATUS = 'N'
	    </select>
	    
	    <!-- 결제 방법별 매출 (추후 확장사항 반영 시 주석 처리 제거) -->
	    <!--
	    <select id="selectSalesByPaymentMethod" resultType="hashmap">
	        SELECT PAYMENT_METHOD, NVL(SUM(PAYMENT_AMOUNT), 0) AS TOTAL_SALES
	        FROM ORDERS
	        WHERE STATUS IN ('배송완료', '교환완료')
	        GROUP BY PAYMENT_METHOD
	        ORDER BY TOTAL_SALES DESC
	    </select>
	    -->
	
	    <!-- 총 주문 건수 -->
	    <select id="selectTotalOrdersCount" resultType="int">
	        SELECT COUNT(ORDER_NO) FROM ORDERS
	    </select>
	
	    <!-- 이번 달 주문 건수 -->
	    <select id="selectMonthlyOrdersCount" resultType="int">
	        SELECT COUNT(ORDER_NO)
	        FROM ORDERS
	        WHERE TO_CHAR(CDATE, 'YYYYMM') = TO_CHAR(SYSDATE, 'YYYYMM')
	    </select>
	
	    <!-- 성별 회원 분포 -->
	    <select id="selectUsersByGenderCount" resultType="hashmap">
	        SELECT GENDER, COUNT(USER_ID) AS USER_COUNT
	        FROM USERS
	        WHERE USERTYPE = 'U'
	        GROUP BY GENDER
	        ORDER BY GENDER DESC
	    </select>
	
	    <!-- 주문 이력이 있는 회원 수 -->
	    <select id="selectUsersWithOrdersCount" resultType="int">
	        SELECT COUNT(DISTINCT USER_ID)
	        FROM ORDERS
	        WHERE STATUS NOT IN ('취소완료', '반품완료') <!-- 취소/반품 완료는 실제 구매자로 간주 안함 -->
	    </select>
	    
	    <!-- 총 미처리 요청 건수 (신고 + 반품요청 + 교환요청 + 상품문의 대기) -->
	    <select id="selectTotalPendingRequestsCount" resultType="int">
	        SELECT
	            (SELECT COUNT(REPORT_BOARD_NO) FROM REPORT_BOARD WHERE STATUS = 'N') +
	            (SELECT COUNT(ORDER_NO) FROM ORDERS WHERE STATUS = '반품요청') +
	            (SELECT COUNT(ORDER_NO) FROM ORDERS WHERE STATUS = '교환요청') +
	            (SELECT COUNT(INQUIRY_NO) FROM PRODUCT_INQUIRY WHERE STATUS = 'N')
	        FROM DUAL
	    </select>
	</mapper>
